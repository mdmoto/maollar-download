<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸‹è½½ Maollar App - å–µä¹å•†åŸ</title>
    <meta name="description" content="ä¸‹è½½Maollarå–µä¹å•†åŸAPPï¼Œäº«å—æ›´æµç•…çš„è´­ç‰©ä½“éªŒ">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            width: 100%;
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        h1 {
            font-size: 32px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
        }

        .version {
            display: inline-block;
            background: #f0f0f0;
            color: #666;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 14px;
            margin-bottom: 30px;
        }

        .download-btn {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 30px;
            border-radius: 50px;
            text-decoration: none;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .download-btn:active {
            transform: translateY(0);
        }

        .download-btn .icon {
            font-size: 24px;
            margin-right: 8px;
            vertical-align: middle;
        }

        .qr-code {
            margin: 30px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 15px;
        }

        .qr-code h3 {
            font-size: 16px;
            color: #666;
            margin-bottom: 15px;
        }

        .qr-code-image {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            background: white;
            padding: 10px;
            border-radius: 10px;
        }

        .qr-code-image img {
            width: 100%;
            height: 100%;
        }

        .features {
            margin-top: 30px;
            text-align: left;
        }

        .feature-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .feature-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 20px;
            flex-shrink: 0;
        }

        .feature-text {
            flex: 1;
        }

        .feature-text h4 {
            font-size: 16px;
            color: #333;
            margin-bottom: 5px;
        }

        .feature-text p {
            font-size: 14px;
            color: #999;
        }

        .info {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #eee;
            font-size: 14px;
            color: #999;
            line-height: 1.8;
        }

        .platform-badge {
            display: inline-flex;
            align-items: center;
            background: #f0f0f0;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            font-size: 14px;
            color: #666;
        }

        .platform-badge .emoji {
            margin-right: 6px;
            font-size: 18px;
        }

        .footer {
            margin-top: 30px;
            font-size: 12px;
            color: #999;
        }

        @media (max-width: 768px) {
            .container {
                padding: 30px 20px;
            }

            h1 {
                font-size: 26px;
            }

            .download-btn {
                font-size: 16px;
                padding: 15px 25px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Logo -->
        <div class="logo">
            <img src="./logo.png" alt="Maollar Logo">
        </div>

        <!-- æ ‡é¢˜ -->
        <h1>å–µä¹å•†åŸ Maollar</h1>
        <p class="subtitle">ä¸€ç«™è´­å…¨çƒ</p>
        
        <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
        <div class="version">Version 0.9.2</div>

        <!-- ä¸‹è½½æŒ‰é’® -->
        <a href="javascript:void(0)" id="downloadBtn" class="download-btn" onclick="smartDownload()">
            <span class="icon">ğŸ“±</span>
            <span id="downloadText">ä¸‹è½½ Android APK (46.3 MB)</span>
        </a>
        <div id="downloadStatus" style="margin-top: 10px; font-size: 14px; color: #666; text-align: center;"></div>

        <!-- å¹³å°æ”¯æŒ -->
        <div style="margin: 20px 0;">
            <span class="platform-badge">
                <span class="emoji">ğŸ¤–</span>
                Android 6.0+
            </span>
            <span class="platform-badge">
                <span class="emoji">ğŸ</span>
                iOS (å³å°†æ¨å‡º)
            </span>
        </div>

        <!-- äºŒç»´ç  -->
        <div class="qr-code">
            <h3>ğŸ“± æ‰«ç ä¸‹è½½</h3>
            <div class="qr-code-image">
                <!-- åœ¨çº¿ç”ŸæˆäºŒç»´ç  -->
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://download.maollar.com" alt="ä¸‹è½½äºŒç»´ç ">
            </div>
        </div>

        <!-- ç‰¹è‰²åŠŸèƒ½ -->
        <div class="features">
            <div class="feature-item">
                <div class="feature-icon">ğŸ±</div>
                <div class="feature-text">
                    <h4>å–µå¸ç³»ç»Ÿ</h4>
                    <p>æ¶ˆè´¹å³æŠ•èµ„ï¼Œè´­ç‰©å³æŒ–çŸ¿</p>
                </div>
            </div>

            <div class="feature-item">
                <div class="feature-icon">ğŸŒ</div>
                <div class="feature-text">
                    <h4>8ç§è¯­è¨€</h4>
                    <p>æ”¯æŒä¸­ã€è‹±ã€æ—¥ã€éŸ©ç­‰å¤šè¯­è¨€</p>
                </div>
            </div>

            <div class="feature-item">
                <div class="feature-icon">ğŸ’³</div>
                <div class="feature-text">
                    <h4>å…¨çƒæ”¯ä»˜</h4>
                    <p>æ”¯ä»˜å®ã€Stripeã€é“¶è¡Œå¡æ”¯ä»˜</p>
                </div>
            </div>

            <div class="feature-item">
                <div class="feature-icon">ğŸ</div>
                <div class="feature-text">
                    <h4>ä¼˜æƒ æ´»åŠ¨</h4>
                    <p>ç­¾åˆ°ã€ä¼˜æƒ åˆ¸ã€åˆ†é”€ç°é‡‘å¥–åŠ±</p>
                </div>
            </div>
        </div>

        <!-- å®‰è£…è¯´æ˜ -->
        <div class="info">
            <strong>ğŸ“ å®‰è£…è¯´æ˜ï¼š</strong><br>
            1. ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ä¸‹è½½APKæ–‡ä»¶<br>
            2. åœ¨æ‰‹æœºä¸Šæ‰¾åˆ°ä¸‹è½½çš„æ–‡ä»¶<br>
            3. ç‚¹å‡»å®‰è£…ï¼ˆéœ€å…è®¸å®‰è£…æœªçŸ¥æ¥æºåº”ç”¨ï¼‰<br>
            4. å®‰è£…å®Œæˆåæ‰“å¼€Appå³å¯ä½¿ç”¨
        </div>

        <!-- ç³»ç»Ÿè¦æ±‚ -->
        <div class="info" style="border-top: none; padding-top: 15px;">
            <strong>ğŸ’» ç³»ç»Ÿè¦æ±‚ï¼š</strong><br>
            Android 6.0 æˆ–æ›´é«˜ç‰ˆæœ¬<br>
            å»ºè®®ï¼šAndroid 8.0+ ä»¥è·å¾—æœ€ä½³ä½“éªŒ
        </div>

        <!-- é¡µè„š -->
        <div class="footer">
            Â© 2025 Maollar Â· å–µä¹å•†åŸ<br>
            <a href="https://m.maollar.com" style="color: #999; text-decoration: none;">è®¿é—®ç½‘é¡µç‰ˆ</a>
        </div>
    </div>

    <script>
        // ============================================
        // æ™ºèƒ½ä¸‹è½½ç³»ç»Ÿ - è‡ªåŠ¨æ£€æµ‹åœ°åŒºå’Œé€‰æ‹©æœ€ä½³ä¸‹è½½æº
        // ============================================

        // ä¸‹è½½æºé…ç½®ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
        const DOWNLOAD_SOURCES = [
            {
                name: 'Cloudflare R2ï¼ˆå›½é™…ï¼‰',
                url: 'https://pub-417ac49c84fe4e1f8570a65abf590010.r2.dev/maollar-app.apk',
                region: 'international',
                testUrl: 'https://pub-417ac49c84fe4e1f8570a65abf590010.r2.dev/',
                priority: 1
            },
            {
                name: 'EC2 æ–°åŠ å¡ï¼ˆä¸­å›½ä¼˜åŒ–ï¼‰',
                url: 'http://54.255.179.211/maollar-app.apk',
                region: 'china',
                testUrl: 'http://54.255.179.211/',
                priority: 2
            }
        ];

        // æ£€æµ‹ç”¨æˆ·æ˜¯å¦åœ¨ä¸­å›½
        function isInChina() {
            // æ£€æµ‹æµè§ˆå™¨è¯­è¨€
            const lang = navigator.language || navigator.userLanguage;
            const isZH = lang.toLowerCase().includes('zh');
            
            // æ£€æµ‹æ—¶åŒºï¼ˆä¸­å›½ä¸º UTC+8ï¼‰
            const timezone = new Date().getTimezoneOffset();
            const isChinaTimezone = (timezone === -480); // UTC+8
            
            // æ£€æµ‹è¯­è¨€ç¯å¢ƒ
            const isChinaLang = lang === 'zh-CN' || lang === 'zh';
            
            return isZH && (isChinaTimezone || isChinaLang);
        }

        // æµ‹è¯•ä¸‹è½½æºå¯ç”¨æ€§
        async function testDownloadSource(source) {
            return new Promise((resolve) => {
                const startTime = Date.now();
                const timeout = 3000; // 3ç§’è¶…æ—¶
                
                const img = new Image();
                img.onload = () => {
                    const latency = Date.now() - startTime;
                    console.log(`âœ… ${source.name} å¯ç”¨ï¼Œå»¶è¿Ÿ: ${latency}ms`);
                    resolve({ available: true, latency, source });
                };
                img.onerror = () => {
                    console.log(`âŒ ${source.name} ä¸å¯ç”¨`);
                    resolve({ available: false, latency: 9999, source });
                };
                
                // è¶…æ—¶å¤„ç†
                setTimeout(() => {
                    console.log(`â±ï¸ ${source.name} è¶…æ—¶`);
                    resolve({ available: false, latency: 9999, source });
                }, timeout);
                
                // å°è¯•åŠ è½½æµ‹è¯•èµ„æº
                img.src = source.testUrl + '?t=' + Date.now();
            });
        }

        // æ™ºèƒ½é€‰æ‹©ä¸‹è½½æº
        async function selectBestDownloadSource() {
            const inChina = isInChina();
            console.log('ğŸŒ ç”¨æˆ·ä½ç½®æ£€æµ‹:', inChina ? 'ä¸­å›½' : 'å›½é™…');
            
            // æ ¹æ®åœ°åŒºæ’åºæº
            let sources = [...DOWNLOAD_SOURCES];
            if (inChina) {
                // ä¸­å›½ç”¨æˆ·ä¼˜å…ˆä½¿ç”¨ EC2
                sources.sort((a, b) => {
                    if (a.region === 'china') return -1;
                    if (b.region === 'china') return 1;
                    return a.priority - b.priority;
                });
            }
            
            // å¹¶å‘æµ‹è¯•æ‰€æœ‰æº
            const results = await Promise.all(sources.map(testDownloadSource));
            
            // é€‰æ‹©å¯ç”¨ä¸”å»¶è¿Ÿæœ€ä½çš„æº
            const available = results.filter(r => r.available);
            if (available.length === 0) {
                console.warn('âš ï¸ æ‰€æœ‰ä¸‹è½½æºä¸å¯ç”¨');
                return sources[0]; // è¿”å›é»˜è®¤æº
            }
            
            // æŒ‰å»¶è¿Ÿæ’åºï¼Œé€‰æ‹©æœ€å¿«çš„
            available.sort((a, b) => a.latency - b.latency);
            const best = available[0].source;
            
            console.log(`âœ… æœ€ä½³ä¸‹è½½æº: ${best.name} (å»¶è¿Ÿ: ${available[0].latency}ms)`);
            return best;
        }

        // æ™ºèƒ½ä¸‹è½½å‡½æ•°
        async function smartDownload() {
            const statusDiv = document.getElementById('downloadStatus');
            const downloadBtn = document.getElementById('downloadBtn');
            const downloadText = document.getElementById('downloadText');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            statusDiv.innerHTML = 'ğŸ” æ­£åœ¨é€‰æ‹©æœ€ä½³ä¸‹è½½æº...';
            downloadBtn.style.opacity = '0.7';
            downloadText.innerHTML = 'æ­£åœ¨å‡†å¤‡ä¸‹è½½...';
            
            try {
                // é€‰æ‹©æœ€ä½³æº
                const bestSource = await selectBestDownloadSource();
                
                // æ›´æ–°çŠ¶æ€
                statusDiv.innerHTML = `ğŸ“¡ ä½¿ç”¨ ${bestSource.name}`;
                downloadText.innerHTML = 'å¼€å§‹ä¸‹è½½...';
                
                // å»¶è¿Ÿ500msè®©ç”¨æˆ·çœ‹åˆ°æç¤º
                setTimeout(() => {
                    // å¼€å§‹ä¸‹è½½
                    window.location.href = bestSource.url;
                    
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    setTimeout(() => {
                        downloadBtn.style.opacity = '1';
                        downloadText.innerHTML = 'ä¸‹è½½ Android APK (46.3 MB)';
                        statusDiv.innerHTML = 'âœ… ä¸‹è½½å·²å¯åŠ¨';
                        
                        // 3ç§’åæ¸…é™¤æç¤º
                        setTimeout(() => {
                            statusDiv.innerHTML = '';
                        }, 3000);
                    }, 1000);
                    
                    // è®°å½•ä¸‹è½½
                    console.log('ğŸ“¥ ä¸‹è½½å¼€å§‹:', bestSource.url);
                }, 500);
                
            } catch (error) {
                console.error('ä¸‹è½½å¤±è´¥:', error);
                statusDiv.innerHTML = 'âŒ ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•';
                downloadBtn.style.opacity = '1';
                downloadText.innerHTML = 'é‡è¯•ä¸‹è½½';
            }
        }

        // è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿ
        const userAgent = navigator.userAgent.toLowerCase();
        const isAndroid = userAgent.indexOf('android') > -1;
        const isIOS = userAgent.indexOf('iphone') > -1 || userAgent.indexOf('ipad') > -1;

        // å¦‚æœæ˜¯iOSï¼Œæ˜¾ç¤ºæç¤º
        if (isIOS) {
            document.getElementById('downloadBtn').innerHTML = `
                <span class="icon">ğŸ</span>
                iOSç‰ˆæœ¬å³å°†æ¨å‡º
            `;
            document.getElementById('downloadBtn').style.background = '#ccc';
            document.getElementById('downloadBtn').style.cursor = 'not-allowed';
            document.getElementById('downloadBtn').onclick = function(e) {
                e.preventDefault();
                alert('iOSç‰ˆæœ¬å³å°†æ¨å‡ºï¼Œæ•¬è¯·æœŸå¾…ï¼\næˆ–è®¿é—®ç½‘é¡µç‰ˆï¼šhttps://m.maollar.com');
            };
        }

        // é¡µé¢åŠ è½½æ—¶é¢„æ£€æµ‹ä¸‹è½½æºï¼ˆæå‰å‡†å¤‡ï¼‰
        window.addEventListener('DOMContentLoaded', async () => {
            if (!isIOS) {
                console.log('ğŸš€ é¢„æ£€æµ‹ä¸‹è½½æº...');
                const bestSource = await selectBestDownloadSource();
                console.log(`âœ… é¢„é€‰æº: ${bestSource.name}`);
                
                // é¢„å…ˆæ˜¾ç¤ºæç¤º
                const statusDiv = document.getElementById('downloadStatus');
                const inChina = isInChina();
                statusDiv.innerHTML = inChina ? 
                    'ğŸ‡¨ğŸ‡³ å·²ä¸ºä¸­å›½ç”¨æˆ·ä¼˜åŒ–ä¸‹è½½é€Ÿåº¦' : 
                    'ğŸŒ å›½é™…é«˜é€Ÿä¸‹è½½';
                statusDiv.style.color = '#4caf50';
            }
        });
    </script>
</body>
</html>

